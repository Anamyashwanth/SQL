# User Defined Functions (UDF)

---

## 1. What is a User Defined Function?

A **User Defined Function (UDF)** is a function created by the user to perform a specific operation and return a value or a table.

* Stored in the database
* Reusable in multiple queries
* Can accept parameters
* Used inside SELECT, WHERE, JOIN, etc.

---

## 2. Why use UDF?

UDF is used to:

* Reuse business logic
* Simplify complex queries
* Perform calculations
* Standardize data transformations
* Improve readability

---

## 3. Types of UDF in SQL Server

There are three types:

1. Scalar Function
2. Inline Table-Valued Function (Inline TVF)
3. Multi-Statement Table-Valued Function (Multi TVF)

---

# 4. Scalar Function

## What is it?

* Returns a **single value**
* Works like built-in functions (LEN, UPPER, etc.)
* Executes row by row

---

## Syntax

```sql
CREATE FUNCTION function_name
(
    @parameter datatype
)
RETURNS return_datatype
AS
BEGIN
    DECLARE @result return_datatype;

    -- Logic
    SET @result = value;

    RETURN @result;
END;
```

---

## Example 1 – Annual Salary

```sql
CREATE FUNCTION fn_AnnualSalary
(
    @Salary DECIMAL(10,2)
)
RETURNS DECIMAL(10,2)
AS
BEGIN
    RETURN @Salary * 12;
END;
```

### Usage

```sql
SELECT name, salary,
       dbo.fn_AnnualSalary(salary) AS AnnualSalary
FROM tbl_emp;
```

### What happens?

For each row, SQL Server calls the function and calculates annual salary.

---

## Example 2 – Experience in Years

```sql
CREATE FUNCTION fn_Experience
(
    @JoinDate DATE
)
RETURNS INT
AS
BEGIN
    RETURN DATEDIFF(YEAR, @JoinDate, GETDATE());
END;
```

---

# 5. Inline Table-Valued Function (Inline TVF)

## What is it?

* Returns a **table**
* Works like a parameterized view
* Best performance among UDFs

---

## Syntax

```sql
CREATE FUNCTION function_name
(
    @parameter datatype
)
RETURNS TABLE
AS
RETURN
(
    SELECT columns
    FROM table
    WHERE condition
);
```

---

## Example – Employees by Department

```sql
CREATE FUNCTION fn_GetEmployeesByDept
(
    @DeptID INT
)
RETURNS TABLE
AS
RETURN
(
    SELECT *
    FROM tbl_emp
    WHERE dept_id = @DeptID
);
```

### Usage

```sql
SELECT *
FROM dbo.fn_GetEmployeesByDept(2);
```

### What happens?

Function returns a filtered table dynamically.

---

# 6. Multi-Statement Table-Valued Function

## What is it?

* Returns a table
* Allows multiple SQL statements
* Used for complex logic

---

## Syntax

```sql
CREATE FUNCTION function_name
(
    @parameter datatype
)
RETURNS @Result TABLE
(
    column_name datatype,
    column_name datatype
)
AS
BEGIN
    INSERT INTO @Result
    SELECT columns
    FROM table
    WHERE condition;

    RETURN;
END;
```

---

## Example – High Salary Employees

```sql
CREATE FUNCTION fn_HighSalaryEmployees
(
    @MinSalary DECIMAL(10,2)
)
RETURNS @EmpTable TABLE
(
    eid INT,
    name VARCHAR(50),
    salary DECIMAL(10,2)
)
AS
BEGIN
    INSERT INTO @EmpTable
    SELECT eid, name, salary
    FROM tbl_emp
    WHERE salary >= @MinSalary;

    RETURN;
END;
```

### Usage

```sql
SELECT *
FROM dbo.fn_HighSalaryEmployees(50000);
```

---

# 7. ALTER Function

```sql
ALTER FUNCTION fn_AnnualSalary
(
    @Salary DECIMAL(10,2)
)
RETURNS DECIMAL(10,2)
AS
BEGIN
    RETURN @Salary * 12;
END;
```

---

# 8. DROP Function

```sql
DROP FUNCTION fn_AnnualSalary;
```

---

# 9. UDF vs Stored Procedure

| UDF                       | Stored Procedure                 |
| ------------------------- | -------------------------------- |
| Must return value/table   | May or may not return value      |
| Can be used inside SELECT | Cannot be used inside SELECT     |
| Cannot modify table data  | Can perform INSERT/UPDATE/DELETE |
| No transaction support    | Supports transactions            |

---

# 10. Performance Notes

* Scalar functions are slow on large data (row-by-row execution)
* Inline TVF performs better
* Avoid complex logic inside scalar UDF
* Prefer Inline TVF for filtering logic

---

# 11. Real-Time Use Cases

* Salary calculations
* Tax calculations
* Data formatting
* Reusable filters
* Business rule implementation

---

# One-line Memory

User Defined Functions are reusable database objects that return a value or a table and can be used inside SQL queries.
