# ðŸ“˜ ORDER BY CLAUSE â€“ DEEP DIVE

## SQL Server (SSMS)

---

## 1ï¸âƒ£ What is ORDER BY Clause?

The **ORDER BY clause** is used to **sort the result set** of a query based on one or more columns or expressions.

ðŸ‘‰ It affects **only the output order**
ðŸ‘‰ It does **not change stored data**
ðŸ‘‰ Sorting is **temporary**

---

## 2ï¸âƒ£ Why ORDER BY Clause is Important?

ORDER BY is important because it:

* Makes data readable
* Supports ranking and reports
* Helps pagination (OFFSETâ€“FETCH)
* Controls result presentation
* Is required for meaningful TOP queries

> Without ORDER BY, SQL Server does **not guarantee row order**.

---

## 3ï¸âƒ£ ORDER BY Clause Usage

ORDER BY can be used with:

* SELECT
* DISTINCT
* TOP
* OFFSETâ€“FETCH

ðŸ“Œ ORDER BY is **not allowed** directly in UPDATE or DELETE.

---

## 4ï¸âƒ£ ORDER BY Basic Syntax

```sql
SELECT column_list
FROM table_name
ORDER BY column_name [ASC | DESC];
```

---

## 5ï¸âƒ£ ORDER BY Default Behavior

```sql
SELECT *
FROM tbl_emp
ORDER BY name;
```

âœ” Default sort order is **ASC (Ascending)**

---

## 6ï¸âƒ£ ORDER BY DESCENDING

```sql
SELECT *
FROM tbl_emp
ORDER BY salary DESC;
```

âœ” Highest salary appears first

---

## 7ï¸âƒ£ ORDER BY Multiple Columns

```sql
SELECT *
FROM tbl_emp
ORDER BY dept ASC, salary DESC;
```

### How it works:

1. Sorts by `dept`
2. Within each dept, sorts by `salary`

---

## 8ï¸âƒ£ ORDER BY with Column Position (NOT Recommended)

```sql
SELECT eid, name, salary
FROM tbl_emp
ORDER BY 3 DESC;
```

ðŸ“Œ `3` refers to the **third column in SELECT**

âš ï¸ Avoid this in real projects (fragile & unreadable).

---

## 9ï¸âƒ£ ORDER BY with Aliases

```sql
SELECT name, salary * 12 AS AnnualSalary
FROM tbl_emp
ORDER BY AnnualSalary DESC;
```

âœ” Alias allowed in ORDER BY
âœ” Cleaner and readable

---

## ðŸ”Ÿ ORDER BY with Expressions

```sql
SELECT name, salary
FROM tbl_emp
ORDER BY salary * 12 DESC;
```

ðŸ“Œ Expression evaluated at runtime.

---

## 1ï¸âƒ£1ï¸âƒ£ ORDER BY with DISTINCT

```sql
SELECT DISTINCT dept
FROM tbl_emp
ORDER BY dept;
```

ðŸ“Œ ORDER BY columns must appear in SELECT list when using DISTINCT.

---

## 1ï¸âƒ£2ï¸âƒ£ ORDER BY with TOP (VERY IMPORTANT)

```sql
SELECT TOP 5 *
FROM tbl_emp
ORDER BY salary DESC;
```

âœ” Returns **top 5 highest-paid employees**

âš ï¸ TOP without ORDER BY gives **random rows**.

---

## 1ï¸âƒ£3ï¸âƒ£ ORDER BY with WITH TIES

```sql
SELECT TOP 3 WITH TIES *
FROM tbl_emp
ORDER BY salary DESC;
```

âœ” Returns extra rows if salaries tie with the 3rd record.

---

## 1ï¸âƒ£4ï¸âƒ£ ORDER BY with NULL Values (TRICKY)

### Default behavior in SQL Server:

* **ASC** â†’ NULLs appear **first**
* **DESC** â†’ NULLs appear **last**

```sql
SELECT *
FROM tbl_emp
ORDER BY salary;
```

---

### Controlling NULL Order (Best Practice)

```sql
SELECT *
FROM tbl_emp
ORDER BY 
CASE WHEN salary IS NULL THEN 1 ELSE 0 END,
salary;
```

âœ” Pushes NULL values to bottom.

---

## 1ï¸âƒ£5ï¸âƒ£ ORDER BY with OFFSETâ€“FETCH (Pagination)

```sql
SELECT *
FROM tbl_emp
ORDER BY eid
OFFSET 5 ROWS
FETCH NEXT 5 ROWS ONLY;
```

ðŸ“Œ Used for **page-wise results**
ðŸ“Œ ORDER BY is **mandatory** for OFFSETâ€“FETCH

---

## 1ï¸âƒ£6ï¸âƒ£ ORDER BY with GROUP BY

```sql
SELECT dept, SUM(salary) AS TotalSalary
FROM tbl_emp
GROUP BY dept
ORDER BY TotalSalary DESC;
```

âœ” Sorts grouped results
âœ” Can use alias

---

## 1ï¸âƒ£7ï¸âƒ£ ORDER BY vs GROUP BY (Common Confusion)

| ORDER BY        | GROUP BY              |
| --------------- | --------------------- |
| Sorts rows      | Groups rows           |
| Affects display | Affects aggregation   |
| Last clause     | Comes before ORDER BY |

---

## 1ï¸âƒ£8ï¸âƒ£ ORDER BY Execution Order

Logical SQL execution order:

1. FROM
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. **ORDER BY**
7. OFFSET / FETCH

ðŸ“Œ ORDER BY executes **after SELECT**.

---

## 1ï¸âƒ£9ï¸âƒ£ Performance Considerations

âœ” Sorting is expensive on large datasets
âœ” ORDER BY on indexed columns is faster
âœ” Avoid ORDER BY unless required
âœ” Use TOP + ORDER BY for efficiency
âœ” Large sorts may use tempdb

---

## 2ï¸âƒ£0ï¸âƒ£ Common ORDER BY Mistakes

âŒ Assuming natural row order
âŒ Using ORDER BY in subqueries unnecessarily
âŒ Using column positions
âŒ Forgetting ORDER BY with TOP
âŒ Ignoring NULL sort behavior

---

## ðŸ§  One-Line Memory (Interview Gold)

> **ORDER BY controls the presentation order of query results, not the stored data.**
