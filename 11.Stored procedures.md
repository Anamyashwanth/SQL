# Stored Procedures 

---

## 1. What is a Stored Procedure?

A **Stored Procedure (SP)** is a precompiled SQL program stored in the database.

Used for:

* Reusable logic
* Business operations
* Data manipulation
* Performance optimization

---

# Types of Stored Procedures

In SQL Server, stored procedures are commonly classified into:

1. Simple Stored Procedure
2. Stored Procedure with Input Parameters
3. Stored Procedure with Output Parameters
4. Stored Procedure with Default Parameters
5. Stored Procedure for INSERT / UPDATE / DELETE (CRUD)
6. Stored Procedure with Conditional Logic
7. Stored Procedure with Transactions
8. Stored Procedure with Error Handling
9. Dynamic Stored Procedure (Dynamic SQL)
10. System Stored Procedures

---

# 1. Simple Stored Procedure

### Example

```sql
CREATE PROCEDURE GetAllEmployees
AS
BEGIN
    SELECT * FROM tbl_emp;
END;
```

Execute:

```sql
EXEC GetAllEmployees;
```

Use case: Basic data retrieval.

---

# 2. Stored Procedure with Input Parameters

```sql
CREATE PROCEDURE GetEmployeesByDept
    @DeptID INT
AS
BEGIN
    SELECT *
    FROM tbl_emp
    WHERE dept_id = @DeptID;
END;
```

Execute:

```sql
EXEC GetEmployeesByDept 2;
```

Use case: Filtered reports.

---

# 3. Stored Procedure with Multiple Parameters

```sql
CREATE PROCEDURE GetEmployees
    @DeptID INT,
    @MinSalary DECIMAL(10,2)
AS
BEGIN
    SELECT *
    FROM tbl_emp
    WHERE dept_id = @DeptID
      AND salary >= @MinSalary;
END;
```

---

# 4. Stored Procedure with Output Parameter

Returns value back to caller.

```sql
CREATE PROCEDURE GetEmployeeCount
    @DeptID INT,
    @EmpCount INT OUTPUT
AS
BEGIN
    SELECT @EmpCount = COUNT(*)
    FROM tbl_emp
    WHERE dept_id = @DeptID;
END;
```

Execute:

```sql
DECLARE @Count INT;
EXEC GetEmployeeCount 1, @Count OUTPUT;
SELECT @Count;
```

Use case: Returning summary values.

---

# 5. Stored Procedure with Default Parameter

```sql
CREATE PROCEDURE GetEmployeesBySalary
    @MinSalary DECIMAL(10,2) = 20000
AS
BEGIN
    SELECT *
    FROM tbl_emp
    WHERE salary >= @MinSalary;
END;
```

Execute:

```sql
EXEC GetEmployeesBySalary;
```

Use case: Optional filters.

---

# 6. CRUD Stored Procedures

### INSERT

```sql
CREATE PROCEDURE AddEmployee
    @Name VARCHAR(50),
    @DeptID INT,
    @Salary DECIMAL(10,2)
AS
BEGIN
    INSERT INTO tbl_emp(name, dept_id, salary)
    VALUES (@Name, @DeptID, @Salary);
END;
```

---

### UPDATE

```sql
CREATE PROCEDURE UpdateEmployeeSalary
    @EmpID INT,
    @Salary DECIMAL(10,2)
AS
BEGIN
    UPDATE tbl_emp
    SET salary = @Salary
    WHERE eid = @EmpID;
END;
```

---

### DELETE

```sql
CREATE PROCEDURE DeleteEmployee
    @EmpID INT
AS
BEGIN
    DELETE FROM tbl_emp
    WHERE eid = @EmpID;
END;
```

---

# 7. Stored Procedure with Conditional Logic

```sql
CREATE PROCEDURE GetEmployeeBySalaryType
    @Salary DECIMAL(10,2)
AS
BEGIN
    IF @Salary > 50000
        SELECT * FROM tbl_emp WHERE salary > 50000;
    ELSE
        SELECT * FROM tbl_emp WHERE salary <= 50000;
END;
```

Use case: Business rules.

---

# 8. Stored Procedure with Transaction

```sql
CREATE PROCEDURE TransferSalary
    @EmpID INT,
    @Amount DECIMAL(10,2)
AS
BEGIN
    BEGIN TRANSACTION;

    UPDATE tbl_emp
    SET salary = salary + @Amount
    WHERE eid = @EmpID;

    IF @@ERROR = 0
        COMMIT;
    ELSE
        ROLLBACK;
END;
```

Use case: Financial operations.

---

# 9. Stored Procedure with Error Handling (TRYâ€¦CATCH)

```sql
CREATE PROCEDURE SafeInsertEmployee
    @Name VARCHAR(50),
    @DeptID INT,
    @Salary DECIMAL(10,2)
AS
BEGIN
    BEGIN TRY
        INSERT INTO tbl_emp(name, dept_id, salary)
        VALUES (@Name, @DeptID, @Salary);
    END TRY
    BEGIN CATCH
        SELECT ERROR_MESSAGE() AS ErrorMessage;
    END CATCH
END;
```

---

# 10. Dynamic Stored Procedure (Dynamic SQL)

```sql
CREATE PROCEDURE GetEmployeesDynamic
    @ColumnName VARCHAR(50)
AS
BEGIN
    DECLARE @SQL NVARCHAR(MAX);

    SET @SQL = 'SELECT ' + @ColumnName + ' FROM tbl_emp';

    EXEC sp_executesql @SQL;
END;
```

Use case: Flexible queries.

---

# 11. System Stored Procedures

Built-in procedures provided by SQL Server.

Examples:
| Procedure     | Usage               |
| ------------- | ------------------- |
| sp_help       | Table structure     |
| sp_helptext   | Procedure/view code |
| sp_helpindex  | Index details       |
| sp_spaceused  | Table size          |
| sp_who2       | Active sessions     |
| sp_executesql | Dynamic SQL         |
| sp_helpdb     | Database details    |

```sql
EXEC sp_help tbl_emp;
EXEC sp_databases;
EXEC sp_tables;
```

---

# Real-Time Stored Procedure Example

### Scenario: Employee Salary Management

## Business Requirement

HR team wants:

* To **increase salary** for employees of a specific department
* Increase by a given percentage
* Return how many employees were updated

This type of logic is commonly used in:

* HR systems
* Payroll processing
* Monthly salary revisions

---

## Table Example

`tbl_emp`

| eid | name | dept_id | salary |
| --- | ---- | ------- | ------ |

---

## Stored Procedure

### Step 1: Create Procedure

```sql
CREATE PROCEDURE UpdateSalaryByDept
    @DeptID INT,
    @PercentIncrease DECIMAL(5,2),
    @RowsAffected INT OUTPUT
AS
BEGIN
    -- Update salary
    UPDATE tbl_emp
    SET salary = salary + (salary * @PercentIncrease / 100)
    WHERE dept_id = @DeptID;

    -- Return number of rows updated
    SET @RowsAffected = @@ROWCOUNT;
END;
```

---

## Step 2: Execute Procedure

```sql
DECLARE @Count INT;

EXEC UpdateSalaryByDept 
    @DeptID = 2,
    @PercentIncrease = 10,
    @RowsAffected = @Count OUTPUT;

SELECT @Count AS EmployeesUpdated;
```

---

## What happens here?

1. HR passes department and percentage
2. Procedure updates salaries
3. `@@ROWCOUNT` stores number of employees affected
4. Output parameter returns that count

---

## Why this is Real-Time?

This pattern is used for:

* Bulk updates safely
* Business logic inside database
* Controlled salary revisions
* Logging and auditing (can be extended)


# Real-Time Classification

Most common in projects:

* Parameterized SP
* CRUD SP
* Transaction + Error Handling SP
* Dynamic SQL SP
* Output parameter SP

---

# One-line Memory

Stored procedures are reusable database programs used to implement business logic, data operations, and controlled transactions.
