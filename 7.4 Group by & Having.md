# GROUP BY & HAVING
---

## 1. What is GROUP BY?

The **GROUP BY clause** is used to **group rows that have the same values** in one or more columns.

* It is mainly used with **aggregate functions**
* It converts **multiple rows into a single summary row**
* It is used for reporting and analysis

---

## 2. Why GROUP BY is required?

GROUP BY is required when:

* We want totals, averages, counts per category
* We want department-wise, city-wise, or category-wise data
* We use aggregate functions along with normal columns

Without GROUP BY, aggregate functions work on the **entire table**.

---

## 3. GROUP BY basic syntax

```sql
SELECT column_name, aggregate_function(column_name)
FROM table_name
GROUP BY column_name;
```

---

## 4. Simple GROUP BY example

```sql
SELECT dept, SUM(salary)
FROM tbl_emp
GROUP BY dept;
```

Explanation:

* Rows are grouped by `dept`
* SUM(salary) is calculated for each department
* One row is returned per department

---

## 5. GROUP BY with multiple columns

```sql
SELECT dept, gender, COUNT(*)
FROM tbl_emp
GROUP BY dept, gender;
```

Explanation:

* Data is grouped first by dept
* Then grouped by gender inside each dept
* One row per unique deptâ€“gender combination

---

## 6. GROUP BY rule (VERY IMPORTANT)

**Rule:**

> Any column in SELECT that is NOT an aggregate function MUST appear in GROUP BY.

Invalid:

```sql
SELECT dept, salary
FROM tbl_emp
GROUP BY dept;
```

Valid:

```sql
SELECT dept, SUM(salary)
FROM tbl_emp
GROUP BY dept;
```

This is a **very common interview question**.

---

## 7. Aggregate functions used with GROUP BY

Common aggregate functions:

* COUNT()
* SUM()
* AVG()
* MIN()
* MAX()

Example:

```sql
SELECT dept,
       COUNT(*) AS EmpCount,
       SUM(salary) AS TotalSalary,
       AVG(salary) AS AvgSalary
FROM tbl_emp
GROUP BY dept;
```

---

## 8. GROUP BY with WHERE clause

```sql
SELECT dept, SUM(salary)
FROM tbl_emp
WHERE dept <> 'HR'
GROUP BY dept;
```

Explanation:

* WHERE filters rows first
* GROUP BY works only on filtered rows
* WHERE cannot use aggregate functions

---

## 9. Logical execution order (GROUP BY focus)

SQL Server executes logically as:

1. FROM
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. ORDER BY

Written order is different from execution order.

---

## 10. What is HAVING clause?

The **HAVING clause** is used to **filter grouped (aggregated) data**.

* HAVING works on **groups**
* WHERE works on **rows**
* HAVING is used **after GROUP BY**

---

## 11. HAVING syntax

```sql
SELECT column_name, aggregate_function(column_name)
FROM table_name
GROUP BY column_name
HAVING condition;
```

---

## 12. HAVING example

```sql
SELECT dept, SUM(salary)
FROM tbl_emp
GROUP BY dept
HAVING SUM(salary) > 100000;
```

Explanation:

* First data is grouped by dept
* SUM(salary) is calculated
* HAVING filters groups where total salary > 100000

---

## 13. WHERE vs HAVING (core difference)

| WHERE                 | HAVING          |
| --------------------- | --------------- |
| Filters rows          | Filters groups  |
| Before GROUP BY       | After GROUP BY  |
| Cannot use aggregates | Uses aggregates |
| Faster                | Slower          |

Always use WHERE when possible for better performance.

---

## 14. WHERE + GROUP BY + HAVING together

```sql
SELECT address, COUNT(eid)
FROM tbl_emp
WHERE address <> 'Hyderabad'
GROUP BY address
HAVING COUNT(eid) >= 2;
```

Explanation:

* WHERE filters rows
* GROUP BY groups data
* HAVING filters grouped result

---

## 15. GROUP BY without HAVING

```sql
SELECT dept, COUNT(*)
FROM tbl_emp
GROUP BY dept;
```

Explanation:

* All groups are returned
* No filtering on aggregated values

---

## 16. HAVING without GROUP BY

```sql
SELECT COUNT(*)
FROM tbl_emp
HAVING COUNT(*) > 10;
```

Explanation:

* Entire table is treated as one group
* Valid but rarely used

---

## 17. GROUP BY with ORDER BY

```sql
SELECT dept, SUM(salary) AS TotalSalary
FROM tbl_emp
GROUP BY dept
ORDER BY TotalSalary DESC;
```

Explanation:

* GROUP BY creates groups
* ORDER BY sorts grouped result

---

## 18. NULL values and GROUP BY

* NULL values form a **separate group**
* All NULLs are grouped together

Example:

```sql
SELECT dept, COUNT(*)
FROM tbl_emp
GROUP BY dept;
```

If dept is NULL, it appears as one group.

---

## 19. Performance considerations

* GROUP BY can be expensive on large tables
* Indexes on GROUP BY columns improve performance
* Always filter rows using WHERE before GROUP BY
* Avoid unnecessary grouping

---

## 20. Common mistakes

* Forgetting GROUP BY with aggregate functions
* Using aggregate functions in WHERE
* Selecting columns not present in GROUP BY
* Confusing WHERE and HAVING
* Grouping more columns than needed

---

## 21. One-line exam / interview memory

GROUP BY groups rows with same values, and HAVING filters those groups.
